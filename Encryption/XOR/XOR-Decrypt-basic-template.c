/* This is an example piece of code to decrypt the xor encryption used
in the xor-encrypt.c template. This decryption could be ran at a later point
in the same executable's flow, or from a separate executable dropped later*/

#include <stdio.h>


//we will now reverse the output of the xor-encrypt.c example.

//This hex array is the encrypted output from running our xor-encrypt.c
unsigned char code[] = "\x1f\x2e\x38\x3f\x4b";

int main() {
	// The decryption key, which was specified in xor-encrypt.c
	// NOTE: We must use single quotes for the key. Double quotes would break the algorithm
	char key = 'K';
	int i = 0;

	//The -1 in the below loop is important to ensure it does not access the 
	//null terminator ('\0') at the end of the loop
	for (i; i < sizeof(code) - 1; i++)
		{
			code[i] = code[i] ^ key;
		}
	//The %s format specifier treats 'code' as a null terminated string
	printf("%s", code);

	/*The above example should decrypt the hex array to 'test', which was our
	encoded string in the xor-encrypt.c */

	/* The printf statement is of course not relevant to actual malware, but
	* is a useful proof that our executable is correctly decrypting the value */

	return 0;
}	